<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatti Communications Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .loader {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .admin-section { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-blue-800">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-96">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800">Chatti Communications</h1>
                <p class="text-gray-600 mt-2">Platform Login</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="admin@chatti.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="••••••••">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Login As</label>
                    <select id="loginRole" class="w-full px-3 py-2 border rounded-lg">
                        <option value="admin">Admin</option>
                        <option value="customer">Customer</option>
                    </select>
                </div>
                <button onclick="login()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                    Sign In
                </button>
                <div class="text-center text-xs text-gray-500 mt-4">
                    Demo: admin@chatti.com / password123
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="px-6 py-3 flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <h1 class="text-xl font-semibold">Chatti Admin</h1>
                    <div class="flex space-x-6">
                        <button onclick="showAdminSection('overview')" class="text-gray-700 hover:text-blue-600">Overview</button>
                        <button onclick="showAdminSection('customers')" class="text-gray-700 hover:text-blue-600">Customers</button>
                        <button onclick="showAdminSection('products')" class="text-gray-700 hover:text-blue-600">Products & Rates</button>
                        <button onclick="showAdminSection('billing')" class="text-gray-700 hover:text-blue-600">Billing</button>
                        <button onclick="showAdminSection('settings')" class="text-gray-700 hover:text-blue-600">Settings</button>
                    </div>
                </div>
                <button onclick="logout()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </nav>

        <!-- Admin Content -->
        <div class="p-6">
            <!-- Overview Section -->
            <div id="admin-overview" class="admin-section" style="display: block;">
                <h2 class="text-2xl font-bold mb-6">SMS Usage Overview</h2>
                
                <!-- Current Month Stats -->
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="text-sm text-gray-600">Total SMS (Month)</div>
                        <div class="text-2xl font-bold text-blue-600" id="totalSMSMonth">0</div>
                        <div class="text-xs text-gray-500">All customers</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="text-sm text-gray-600">Inbound SMS</div>
                        <div class="text-2xl font-bold text-green-600" id="inboundSMS">0</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="text-sm text-gray-600">Outbound SMS</div>
                        <div class="text-2xl font-bold text-purple-600" id="outboundSMS">0</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="text-sm text-gray-600">Active Customers</div>
                        <div class="text-2xl font-bold" id="activeCustomers">0</div>
                    </div>
                </div>

                <!-- SMS by Country -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <h3 class="font-semibold mb-3">SMS Usage by Country (Current Month)</h3>
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Country</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Inbound</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Outbound</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                            </tr>
                        </thead>
                        <tbody id="countryUsageTable">
                            <tr>
                                <td colspan="4" class="px-4 py-2 text-center text-gray-500">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Month Selector -->
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold">Historical Data</h3>
                        <input type="month" id="monthSelector" class="px-3 py-1 border rounded" onchange="loadMonthData()">
                    </div>
                    <div id="historicalData" class="text-gray-500 text-center py-4">
                        Select a month to view historical data
                    </div>
                </div>
            </div>

            <!-- Customers Section -->
            <div id="admin-customers" class="admin-section">
                <h2 class="text-2xl font-bold mb-6">Customer Management</h2>
                
                <!-- Customer List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="p-4 border-b">
                        <div class="flex justify-between items-center">
                            <input type="text" placeholder="Search customers..." class="px-3 py-2 border rounded-lg w-64">
                            <button onclick="showLinkCustomerModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-link mr-2"></i>Link Account
                            </button>
                        </div>
                    </div>
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Vonage Account</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Xero Contact</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">SMS (Month)</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Numbers</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customerTable">
                            <tr>
                                <td colspan="6" class="px-4 py-2 text-center text-gray-500">Loading customers...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products & Rates Section -->
            <div id="admin-products" class="admin-section">
                <h2 class="text-2xl font-bold mb-6">Products & Rates</h2>
                
                <div class="grid grid-cols-2 gap-6">
                    <!-- Product Mapping -->
                    <div class="bg-white rounded-lg shadow p-4">
                        <h3 class="font-semibold mb-3">Product Mapping</h3>
                        <button onclick="showAddProductModal()" class="bg-green-600 text-white px-3 py-1 rounded text-sm mb-3 hover:bg-green-700">
                            <i class="fas fa-plus mr-1"></i>Add Mapping
                        </button>
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-2 py-1 text-left">Vonage Product</th>
                                    <th class="px-2 py-1 text-left">Xero Item</th>
                                    <th class="px-2 py-1 text-left">Type</th>
                                </tr>
                            </thead>
                            <tbody id="productMappingTable">
                                <tr>
                                    <td class="px-2 py-1">SMS-AU</td>
                                    <td class="px-2 py-1">SMS Australia</td>
                                    <td class="px-2 py-1">SMS</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Customer Rates -->
                    <div class="bg-white rounded-lg shadow p-4">
                        <h3 class="font-semibold mb-3">Customer Rates</h3>
                        <select class="w-full px-3 py-1 border rounded mb-3">
                            <option>Select Customer</option>
                        </select>
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-2 py-1 text-left">Product</th>
                                    <th class="px-2 py-1 text-left">Rate</th>
                                    <th class="px-2 py-1 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customerRatesTable">
                                <tr>
                                    <td colspan="3" class="px-2 py-1 text-center text-gray-500">Select a customer</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Billing Section -->
            <div id="admin-billing" class="admin-section">
                <h2 class="text-2xl font-bold mb-6">Billing & Invoicing</h2>
                
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold">Draft Invoices</h3>
                        <button onclick="generateDraftInvoices()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            <i class="fas fa-file-invoice mr-2"></i>Generate Draft Invoices
                        </button>
                    </div>
                    <div id="draftInvoicesTable" class="text-gray-500 text-center py-8">
                        No draft invoices generated yet
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="admin-settings" class="admin-section">
                <h2 class="text-2xl font-bold mb-6">API Settings</h2>
                
                <div class="grid grid-cols-2 gap-6">
                    <!-- Vonage API -->
                    <div class="bg-white rounded-lg shadow p-4">
                        <h3 class="font-semibold mb-3">Vonage API Configuration</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">API Key</label>
                                <input type="password" id="vonageApiKey" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter API Key">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">API Secret</label>
                                <input type="password" id="vonageApiSecret" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter API Secret">
                            </div>
                            <button onclick="saveVonageSettings()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Save Settings</button>
                        </div>
                    </div>

                    <!-- Xero API -->
                    <div class="bg-white rounded-lg shadow p-4">
                        <h3 class="font-semibold mb-3">Xero API Configuration</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Client ID</label>
                                <input type="password" id="xeroClientId" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter Client ID">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Client Secret</label>
                                <input type="password" id="xeroClientSecret" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter Client Secret">
                            </div>
                            <button onclick="connectXero()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Connect to Xero</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Dashboard -->
    <div id="customerDashboard" class="hidden">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="px-6 py-3 flex justify-between items-center">
                <h1 class="text-xl font-semibold">Chatti Customer Portal</h1>
                <button onclick="logout()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </nav>

        <!-- Customer Content -->
        <div class="p-6 max-w-6xl mx-auto">
            <h2 class="text-2xl font-bold mb-6">Your SMS Usage</h2>
            
            <!-- Current Month Stats -->
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="bg-white p-4 rounded-lg shadow">
                    <div class="text-sm text-gray-600">Current Month SMS</div>
                    <div class="text-2xl font-bold text-blue-600" id="customerCurrentSMS">0</div>
                    <div class="text-xs text-gray-500">Total messages</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <div class="text-sm text-gray-600">Previous Month SMS</div>
                    <div class="text-2xl font-bold text-gray-600" id="customerPreviousSMS">0</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <div class="text-sm text-gray-600">Trend</div>
                    <div class="text-2xl font-bold text-green-600" id="customerTrend">+0%</div>
                </div>
            </div>

            <!-- Usage Details -->
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="font-semibold mb-3">Usage Breakdown</h3>
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left">Month</th>
                            <th class="px-4 py-2 text-left">Inbound SMS</th>
                            <th class="px-4 py-2 text-left">Outbound SMS</th>
                            <th class="px-4 py-2 text-left">Total</th>
                        </tr>
                    </thead>
                    <tbody id="customerUsageTable">
                        <tr>
                            <td colspan="4" class="px-4 py-2 text-center text-gray-500">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>